<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Campaign Targets</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            function updateProductDropdown(client_id) {
                $.ajax({
                    url: "{% url 'get_products_for_client' %}",
                    data: { client_id: client_id },
                    success: function(data) {
                        let productSelect = $('#id_product');
                        productSelect.empty();  // Clear previous options
                        productSelect.append('<option value="">-- Select Product --</option>');
                        data.products.forEach(function(product) {
                            productSelect.append('<option value="' + product + '">' + product + '</option>');
                        });
                    },
                    error: function() {
                        alert('Error loading products.');
                    }
                });
            }

            // Trigger product update when the client is selected
            $('#id_client').on('change', function() {
                let client_id = $(this).val();
                if (client_id) {
                    updateProductDropdown(client_id);
                } else {
                    $('#id_product').empty().append('<option value="">-- Select Product --</option>');  // Clear if no client is selected
                }
            });
        });
    </script>
</head>
<body>
    <h1>Enter Campaign Targets</h1>

    <form method="post">
        {% csrf_token %}
        
        <div>
            <label for="id_client">Select Client:</label>
            {{ form.client }}
        </div>
    
        <div>
            <label for="id_product">Select Product:</label>
            {{ form.product }}
        </div>
    
        <div>
            <label for="id_campaign_type">Campaign Type:</label>
            {{ form.campaign_type }}
        </div>
    
        <div>
            <label for="id_month">Select Month:</label>
            {{ form.month }}  <!-- This uses the month-only input type -->
        </div>
    
        <div>
            <label for="id_target_spend">Target Spend:</label>
            {{ form.target_spend }}
        </div>
    
        <div>
            <label for="id_target_impressions">Target Impressions:</label>
            {{ form.target_impressions }}
        </div>
    
        <div>
            <label for="id_target_clicks">Target Clicks:</label>
            {{ form.target_clicks }}
        </div>
    
        <button type="submit">Save Targets</button>
    </form>
    
    {% if form.errors %}
    <div class="form-errors">
        <ul>
            {% for field, errors in form.errors.items %}
                <li>{{ field }}: {{ errors }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

</body>
</html>
